<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-6">
  <h1 class="text-2xl sm:text-3xl font-bold text-forest-800">Carte des boissons</h1>
  <%= link_to "Ajouter une boisson", new_admin_beverage_path, class: "bg-gold-500 text-white px-4 py-2 rounded hover:bg-gold-600 transition-colors self-start sm:self-auto" %>
</div>

<% Beverage::CATEGORIES.each do |category_key, category_label| %>
  <% beverages = @beverages_by_category[category_key] %>

  <div class="mb-8">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-xl font-bold text-forest-700"><%= category_label %></h2>
      <%= link_to "Ajouter", new_admin_beverage_path(category: category_key), class: "text-sm bg-forest-600 text-white px-3 py-1 rounded hover:bg-forest-700 transition-colors" %>
    </div>

    <%# ===== MOBILE CARDS ===== %>
    <div class="md:hidden space-y-2">
      <% if beverages&.any? %>
        <% beverages.each do |beverage| %>
          <div class="bg-white rounded-lg shadow p-4 <%= 'opacity-50' unless beverage.active %>">
            <div class="flex items-start justify-between gap-2">
              <div class="flex-1 min-w-0">
                <div class="flex items-center gap-2">
                  <p class="font-medium text-forest-800"><%= beverage.name %></p>
                  <% if beverage.active %>
                    <span class="inline-block w-2.5 h-2.5 bg-green-500 rounded-full shrink-0" title="Actif"></span>
                  <% else %>
                    <span class="inline-block w-2.5 h-2.5 bg-gray-300 rounded-full shrink-0" title="Inactif"></span>
                  <% end %>
                </div>
                <% if beverage.description.present? %>
                  <p class="text-sm text-gray-500 mt-0.5"><%= truncate(beverage.description, length: 40) %></p>
                <% end %>
              </div>
              <div class="text-right shrink-0">
                <% if beverage.has_multiple_sizes? %>
                  <div class="text-xs text-gray-600 space-y-0.5">
                    <% if beverage.price_small.present? %>
                      <p>P: <%= number_to_currency(beverage.price_small, unit: "€", format: "%n%u") %></p>
                    <% end %>
                    <% if beverage.price_medium.present? %>
                      <p>M: <%= number_to_currency(beverage.price_medium, unit: "€", format: "%n%u") %></p>
                    <% end %>
                    <% if beverage.price_large.present? %>
                      <p>G: <%= number_to_currency(beverage.price_large, unit: "€", format: "%n%u") %></p>
                    <% end %>
                  </div>
                <% else %>
                  <p class="font-semibold text-gold-600"><%= number_to_currency(beverage.price, unit: "€", format: "%n %u") %></p>
                <% end %>
              </div>
            </div>
            <div class="flex justify-end gap-3 mt-3 pt-2 border-t border-gray-100">
              <%= link_to "Modifier", edit_admin_beverage_path(beverage), class: "text-sm text-forest-600 hover:text-forest-800 font-medium" %>
              <%= link_to "Supprimer", admin_beverage_path(beverage), method: :delete, data: { turbo_method: :delete, turbo_confirm: "Êtes-vous sûr ?" }, class: "text-sm text-red-600 hover:text-red-800 font-medium" %>
            </div>
          </div>
        <% end %>
      <% else %>
        <div class="bg-white rounded-lg shadow p-6 text-center text-gray-500">Aucune boisson dans cette catégorie.</div>
      <% end %>
    </div>

    <%# ===== DESKTOP TABLE ===== %>
    <div class="hidden md:block bg-white rounded-lg shadow overflow-hidden">
      <table class="w-full">
        <thead class="bg-forest-800 text-white">
          <tr>
            <th class="px-4 py-3 text-left w-12">#</th>
            <th class="px-4 py-3 text-left">Nom</th>
            <th class="px-4 py-3 text-left">Description</th>
            <th class="px-4 py-3 text-center">Prix</th>
            <th class="px-4 py-3 text-center">Actif</th>
            <th class="px-4 py-3 text-right">Actions</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
          <% if beverages&.any? %>
            <% beverages.each do |beverage| %>
              <tr class="hover:bg-gray-50 <%= 'opacity-50' unless beverage.active %>">
                <td class="px-4 py-3 text-gray-500 text-sm"><%= beverage.position %></td>
                <td class="px-4 py-3 font-medium"><%= beverage.name %></td>
                <td class="px-4 py-3 text-sm text-gray-600"><%= truncate(beverage.description, length: 40) %></td>
                <td class="px-4 py-3 text-center text-sm">
                  <% if beverage.has_multiple_sizes? %>
                    <span class="text-xs">
                      <%= beverage.price_small.present? ? "#{number_to_currency(beverage.price_small, unit: '€', format: '%n%u')}" : "" %>
                      <%= beverage.price_medium.present? ? "/ #{number_to_currency(beverage.price_medium, unit: '€', format: '%n%u')}" : "" %>
                      <%= beverage.price_large.present? ? "/ #{number_to_currency(beverage.price_large, unit: '€', format: '%n%u')}" : "" %>
                    </span>
                  <% else %>
                    <%= number_to_currency(beverage.price, unit: "€", format: "%n %u") %>
                  <% end %>
                </td>
                <td class="px-4 py-3 text-center">
                  <% if beverage.active %>
                    <span class="inline-block w-3 h-3 bg-green-500 rounded-full" title="Actif"></span>
                  <% else %>
                    <span class="inline-block w-3 h-3 bg-gray-300 rounded-full" title="Inactif"></span>
                  <% end %>
                </td>
                <td class="px-4 py-3 text-right">
                  <%= link_to "Modifier", edit_admin_beverage_path(beverage), class: "text-forest-600 hover:text-forest-800 mr-3" %>
                  <%= link_to "Supprimer", admin_beverage_path(beverage), method: :delete, data: { turbo_method: :delete, turbo_confirm: "Êtes-vous sûr ?" }, class: "text-red-600 hover:text-red-800" %>
                </td>
              </tr>
            <% end %>
          <% else %>
            <tr>
              <td colspan="6" class="px-4 py-6 text-center text-gray-500">Aucune boisson dans cette catégorie.</td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
<% end %>
